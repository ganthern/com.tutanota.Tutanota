{
    "app-id": "com.tutanota.Tutanota",
    "runtime": "org.freedesktop.Platform",
    "runtime-version": "19.08",
    "branch": "stable",
    "sdk": "org.freedesktop.Sdk",
    "base": "org.electronjs.Electron2.BaseApp",
    "base-version": "19.08",
    "command": "tutanota-desktop",
    "separate-locales": false,
    "finish-args": [
        "--share=ipc",
        "--socket=x11",
        "--socket=wayland",
        "--socket=pulseaudio",
        "--share=network",
        "--filesystem=host",
        "--talk-name=org.freedesktop.Notifications",
        "--env=TMPDIR=/var/tmp"
    ],
    "build-options" : {
	"env": {
            "NPM_CONFIG_LOGLEVEL": "info"
	}
    },
    "modules": [
  "shared-modules/python2.7/python-2.7.json",
	{
	    "name": "nodejs",
	    "cleanup": [
		"/**"
	    ],
	    "sources": [
		{
		    "type": "archive",
		    "url": "https://nodejs.org/dist/v14.9.0/node-v14.9.0.tar.xz",
		    "sha256": "012ef6b715306a56183696a878a4803c2edab4f25f1bf3f40425320cf28e6ef6"
		}
	    ]
	},
        {
            "name": "tutanota",
            "build-options" : {
                "env": {
                    "electron_config_cache": "/run/build/tutanota/npm-cache",
		    "ELECTRON_BUILDER_CACHE": "/run/build/tutanota/npm-cache",
		    "ELECTRON_CACHE": "/run/build/tutanota/npm-cache"
                }
            },
            "buildsystem": "simple",
            "sources": [
                {
                    "type": "git",
                    "url": "https://github.com/tutao/tutanota.git",
		    "tag": "tutanota-release-3.76.9",
                    "commit": "826d1506649e91504e83bc3060da5049c9fcf245"
                },
 		{
		    "type": "patch",
		    "path": "dist.patch"
		},
		"generated-sources.json",
		"dist-generated-sources.json",
		{
                    "type": "file",
                    "path": "package-lock.json",
		    "dest": "build/dist"
                }
            ],
	    "build-commands": [
		"npm install --offline --cache=/run/build/tutanota/npm-cache",
		"node dist release -l",
		"mkdir -p /app/lib/",
		"cp -r build/dist/installers/linux*-unpacked /app/lib/tutanota",
		"ln -s /app/lib/tutanota/tutanota-desktop /app/bin/tutanota-desktop",
		"install -Dm644 resources/desktop-icons/icon/512.png /app/share/icons/hicolor/512x512/apps/com.tutanota.Tutanota.png",
		"install -Dm644 resources/desktop-icons/icon/64.png /app/share/icons/hicolor/64x64/apps/com.tutanota.Tutanota.png"
	    ]
        },
        {
            "name": "metadata",
            "buildsystem": "simple",
            "sources": [
		{
                    "type": "file",
                    "path": "com.tutanota.Tutanota.appdata.xml"
                },
		{
                    "type": "file",
                    "path": "com.tutanota.Tutanota.desktop"
                }
            ],
	    "build-commands": [
		"install -Dm644 com.tutanota.Tutanota.appdata.xml /app/share/appdata/com.tutanota.Tutanota.appdata.xml",
		"install -Dm644 com.tutanota.Tutanota.desktop /app/share/applications/com.tutanota.Tutanota.desktop"
	    ]
        }
    ]
}
